<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Dentista</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶∑</text></svg>">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="css/styles.css">
  <!-- Adicionar FullCalendar CSS -->
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      padding-top: 70px;
      background-color: #f8f9fa;
    }
    .sidebar {
      background-color: #fff;
      height: 100vh;
      padding-top: 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.05);
    }
    .sidebar a {
      display: block;
      padding: 10px 20px;
      color: #333;
      text-decoration: none;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease-in-out;
    }
    .sidebar a:hover,
    .sidebar a.active {
      color: #007bff;
    }
    .sidebar a::after {
      content: "";
      position: absolute;
      bottom: 5px;
      left: 20px;
      width: 0;
      height: 2px;
      background-color: #007bff;
      transition: width 0.3s ease-in-out;
    }
    .sidebar a:hover::after,
    .sidebar a.active::after {
      width: 50px;
    }
    .content {
      padding: 20px;
    }
    .card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .card:hover {
      transform: none;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .card-title {
      color: #2c3e50;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card-title i {
      color: #0d6efd;
    }
    .list-group-item {
      border: none;
      border-radius: 10px !important;
      margin-bottom: 8px;
      background-color: #f8f9fa;
      transition: all 0.2s ease;
    }
    .list-group-item:hover {
      background-color: #e9ecef;
      transform: translateX(5px);
    }
    .badge-horario {
      background-color: #e3f2fd;
      color: #0d6efd;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.85em;
    }
    .badge-servico {
      background-color: #0d6efd;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.85em;
    }
    .paciente-info {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #6c757d;
    }
    .paciente-info i {
      color: #0d6efd;
    }
    .proximo-agendamento {
      background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
      color: white;
    }
    .proximo-agendamento .card-title {
      color: white !important;
      font-weight: 600;
    }
    .proximo-agendamento .card-subtitle {
      color: #e3f2fd !important;
    }
    .proximo-agendamento .card-text {
      color: white;
    }
    .proximo-agendamento .badge {
      background-color: rgba(255,255,255,0.2);
      color: white;
    }
    .proximo-agendamento .paciente-info {
      color: white;
    }
    .proximo-agendamento .paciente-info i {
      color: rgba(255, 255, 255, 0.9);
    }
    .saudacao {
      color: #2c3e50;
      font-weight: 600;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e9ecef;
    }
    .saudacao i {
      color: #0d6efd;
      margin-right: 10px;
    }
    .date-selector {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 1rem;
    }
    .date-selector select {
      border: 1px solid #e3f2fd;
      border-radius: 8px;
      padding: 8px 12px;
      color: #0d6efd;
      background-color: #e3f2fd;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .date-selector select:hover {
      background-color: #bbdefb;
    }
    .date-selector select:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.25);
    }
    .date-selector i {
      color: #0d6efd;
    }
    .badge-status {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.85em;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .badge-concluida {
      background-color: #d4edda;
      color: #155724;
    }
    .badge-cancelada {
      background-color: #f8d7da;
      color: #721c24;
    }
    .badge-agendada {
      background-color: #e3f2fd;
      color: #0d6efd;
    }
    .list-group-item.concluida {
      border-left: 4px solid #28a745;
    }
    .list-group-item.cancelada {
      border-left: 4px solid #dc3545;
    }
    .list-group-item.agendada {
      border-left: 4px solid #0d6efd;
    }
    .list-group-item.concluida:hover {
      background-color: #d4edda;
    }
    .list-group-item.cancelada:hover {
      background-color: #f8d7da;
    }
    .list-group-item.agendada:hover {
      background-color: #e3f2fd;
    }
    .badge-cancelamento-tardio {
      background-color: #dc3545;
      color: white;
    }
    .list-group-item.cancelamento-tardio {
      border-left: 4px solid #dc3545;
      background-color: #fff5f5;
    }
    .list-group-item.cancelamento-tardio:hover {
      background-color: #ffe5e5;
    }
    .list-group-item.concluida {
      border-left: 4px solid #28a745;
      background-color: #f0fff4;
    }
    .list-group-item.concluida:hover {
      background-color: #e6ffed;
    }
    .list-group-item.cancelada {
      border-left: 4px solid #6c757d;
      background-color: #f8f9fa;
    }
    .list-group-item.cancelada:hover {
      background-color: #e9ecef;
    }
    .list-group-item.agendada {
      border-left: 4px solid #0d6efd;
      background-color: #f0f7ff;
    }
    .list-group-item.agendada:hover {
      background-color: #e6f2ff;
    }
    .status-agendada {
      background-color: #e3f2fd !important;
      border-left: 4px solid #2196f3 !important;
    }
    .status-concluida {
      background-color: #e8f5e9 !important;
      border-left: 4px solid #4caf50 !important;
    }
    .status-cancelada {
      background-color: #ffebee !important;
      border-left: 4px solid #f44336 !important;
    }
    .status-cancelamento-tardio {
      background-color: #fff3e0 !important;
      border-left: 4px solid #ff9800 !important;
    }
    .status-agendada:hover {
      background-color: #bbdefb !important;
    }
    .status-concluida:hover {
      background-color: #c8e6c9 !important;
    }
    .status-cancelada:hover {
      background-color: #ffcdd2 !important;
    }
    .status-cancelamento-tardio:hover {
      background-color: #ffe0b2 !important;
    }
    /* Estilos do Calend√°rio */
    #calendar {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .fc {
      font-family: inherit;
    }

    .fc .fc-toolbar {
      margin-bottom: 1.5rem !important;
    }

    .fc .fc-toolbar-title {
      font-size: 1.5rem !important;
      font-weight: 600;
      color: #2c3e50;
    }

    .fc .fc-button {
      padding: 0.5rem 1rem;
      font-weight: 500;
      text-transform: capitalize;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .fc .fc-button-primary {
      background-color: #0d6efd;
      border-color: #0d6efd;
    }

    .fc .fc-button-primary:hover {
      background-color: #0b5ed7;
      border-color: #0a58ca;
    }

    .fc .fc-button-primary:not(:disabled).fc-button-active {
      background-color: #0a58ca;
      border-color: #0a53be;
    }

    .fc .fc-daygrid-day {
      transition: all 0.2s;
    }

    .fc .fc-daygrid-day:hover {
      background-color: #f8f9fa;
    }

    .fc .fc-day-today {
      background-color: #e8f4ff !important;
    }

    .fc .fc-daygrid-day-number {
      padding: 8px;
      color: #495057;
      text-decoration: none;
    }

    .fc .fc-event {
      border-radius: 4px;
      padding: 2px 4px;
      margin: 1px 0;
      cursor: pointer;
      font-size: 0.85rem;
      border: none;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .fc .fc-event:hover {
      filter: brightness(0.95);
    }

    .fc .fc-daygrid-event-dot {
      border-color: inherit;
      margin-right: 4px;
    }

    .fc .fc-daygrid-more-link {
      color: #0d6efd;
      font-weight: 500;
      padding: 2px 4px;
      background: #e8f4ff;
      border-radius: 4px;
    }

    .fc .fc-daygrid-more-link:hover {
      background: #d1e7ff;
    }

    /* Classes de movimento */
    .movimento-vazio {
      background-color: #f8f9fa;
    }

    .movimento-normal {
      background-color: #e8f4ff;
    }

    .movimento-cheio {
      background-color: #d1e7ff;
    }

    .movimento-folga {
      background-color: #fff3cd;
    }

    .fc-day-past {
      background-color: #f8f9fa;
      opacity: 0.7;
    }

    /* Tooltip personalizado */
    .fc-event-tooltip {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 1000;
    }

    /* Estilo para dias passados */
    .fc-day-past .fc-daygrid-day-number {
      color: #adb5bd !important;
    }

    .fc-day-past .fc-daygrid-day-frame {
      background-color: #f8f9fa !important;
    }

    /* Ajuste para eventos em dias passados */
    .fc-day-past .fc-event {
      opacity: 0.7;
      filter: grayscale(50%);
    }

    /* Estilo para o dia atual */
    .fc-day-today {
      background-color: #e3f2fd !important;
      border: 2px solid #0d6efd !important;
    }

    .fc-day-today .fc-daygrid-day-number {
      color: #0d6efd !important;
      font-weight: bold !important;
    }

    /* Ajuste para os eventos */
    .fc-event {
      cursor: pointer;
      border: none !important;
      padding: 2px 4px;
      font-size: 0.9em;
      transition: all 0.2s ease;
    }

    .fc-event:hover {
      transform: scale(1.02);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Ajuste para o cabe√ßalho do calend√°rio */
    .fc-toolbar {
      margin-bottom: 1.5em !important;
    }

    .fc-toolbar-title {
      font-size: 1.5em !important;
      color: #2c3e50;
      font-weight: 600;
      text-transform: capitalize;
    }

    /* Ajuste para os bot√µes de navega√ß√£o */
    .fc-button {
      text-transform: capitalize !important;
      font-weight: 500 !important;
      padding: 0.5em 1em !important;
    }

    .fc-button-primary {
      background-color: #0d6efd !important;
      border-color: #0d6efd !important;
      box-shadow: 0 2px 4px rgba(13, 110, 253, 0.1) !important;
    }

    .fc-button-primary:hover {
      background-color: #0b5ed7 !important;
      border-color: #0a58ca !important;
      transform: translateY(-1px);
      box-shadow: 0 4px 6px rgba(13, 110, 253, 0.15) !important;
    }

    .fc-button-primary:not(:disabled):active {
      background-color: #0a58ca !important;
      border-color: #0a53be !important;
      transform: translateY(0);
    }

    /* Ajuste para o grid do calend√°rio */
    .fc-daygrid-day-frame {
      min-height: 100px;
      padding: 4px;
      transition: all 0.2s ease;
    }

    .fc-daygrid-day-frame:hover {
      background-color: rgba(13, 110, 253, 0.05);
    }

    /* Ajuste para o n√∫mero do dia */
    .fc-daygrid-day-number {
      font-size: 1.1em;
      font-weight: 500;
      color: #2c3e50;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .fc-daygrid-day-number:hover {
      background-color: rgba(13, 110, 253, 0.1);
    }

    .fc {
      max-width: 100%;
      height: calc(100vh - 200px) !important;
    }

    /* Cores para os diferentes n√≠veis de movimento */
    .movimento-folga {
      background-color: #e8f5e9 !important; /* Verde claro para folga */
      border-left: 4px solid #4caf50 !important;
    }

    .movimento-normal {
      background-color: #fff3e0 !important; /* Amarelo claro para movimento normal */
      border-left: 4px solid #ff9800 !important;
    }

    .movimento-cheio {
      background-color: #ffebee !important; /* Vermelho claro para movimento cheio */
      border-left: 4px solid #f44336 !important;
    }

    .movimento-vazio {
      background-color: #f5f5f5 !important; /* Cinza claro para dia sem consultas */
      border-left: 4px solid #9e9e9e !important;
    }

    /* Legenda do Calend√°rio */
    .calendario-legenda {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 20px 0;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .legenda-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: #f8f9fa;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .legenda-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .legenda-cor {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: 2px solid transparent;
    }

    .legenda-cor.folga {
      background-color: #e8f5e9;
      border-color: #4caf50;
    }

    .legenda-cor.normal {
      background-color: #fff3e0;
      border-color: #ff9800;
    }

    .legenda-cor.cheio {
      background-color: #ffebee;
      border-color: #f44336;
    }

    .legenda-cor.vazio {
      background-color: #f5f5f5;
      border-color: #9e9e9e;
    }

    .legenda-texto {
      font-size: 0.95em;
      color: #2c3e50;
      font-weight: 500;
    }

    .legenda-descricao {
      font-size: 0.85em;
      color: #6c757d;
      margin-top: 2px;
    }

    .user-info {
      color: #fff;
      margin-right: 20px;
      font-size: 0.95rem;
    }

    /* Novos estilos para o card de consultas */
    .card-consultas {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .card-consultas .card-header {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      padding: 1.2rem;
      border: none;
    }

    .card-consultas .card-header h5 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .periodo-divisor {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 15px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #e9ecef;
    }

    .periodo-divisor.manha {
      background: linear-gradient(to right, #fff5e6, #fff);
    }

    .periodo-divisor.tarde {
      background: linear-gradient(to right, #e6f3ff, #fff);
    }

    .periodo-divisor i {
      font-size: 1.2rem;
    }

    .periodo-divisor.manha i {
      color: #ffa500;
    }

    .periodo-divisor.tarde i {
      color: #0056b3;
    }

    .periodo-divisor h6 {
      margin: 0;
      font-weight: 600;
      color: #2c3e50;
    }

    .lista-consultas {
      padding: 0;
      margin: 0;
      list-style: none;
    }

    .consulta-item {
      padding: 15px 20px;
      border-bottom: 1px solid #e9ecef;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .consulta-item:hover {
      background: #f8f9ff;
    }

    .consulta-item.atual {
      background: #e3f2fd;
      border-left: 4px solid #007bff;
      box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
    }

    .consulta-item.proxima {
      background: #fff;
    }

    .consulta-item.futura {
      opacity: 0.8;
    }

    .consulta-horario {
      min-width: 80px;
      font-weight: 600;
      color: #2c3e50;
      font-size: 0.95rem;
    }

    .consulta-info {
      flex: 1;
    }

    .consulta-paciente {
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 3px;
    }

    .consulta-servico {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #666;
      font-size: 0.9rem;
    }

    .consulta-servico i {
      font-size: 1.1rem;
    }

    .consulta-servico.clareamento i { color: #ffd700; }
    .consulta-servico.restauracao i { color: #6c757d; }
    .consulta-servico.ortodontia i { color: #28a745; }
    .consulta-servico.extracao i { color: #dc3545; }
    .consulta-servico.limpeza i { color: #17a2b8; }
    .consulta-servico.avaliacao i { color: #6f42c1; }

    .consulta-status {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .consulta-status.atual {
      background: #007bff;
      color: white;
    }

    .consulta-status.proxima {
      background: #e3f2fd;
      color: #007bff;
    }

    .sem-consultas {
      padding: 30px 20px;
      text-align: center;
      color: #6c757d;
      background: #f8f9fa;
    }

    .sem-consultas i {
      font-size: 2rem;
      margin-bottom: 10px;
      color: #dee2e6;
    }

    /* Estilos para os separadores de per√≠odo */
    .periodo-separador {
      padding: 12px 20px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .periodo-separador.manha {
      background: linear-gradient(135deg, #fff5e6 0%, #fff 100%);
      border-bottom: 1px solid #ffe0b2;
    }

    .periodo-separador.tarde {
      background: linear-gradient(135deg, #e3f2fd 0%, #fff 100%);
      border-bottom: 1px solid #bbdefb;
    }

    .periodo-separador i {
      font-size: 1.2rem;
      width: 24px;
      text-align: center;
    }

    .periodo-separador.manha i {
      color: #ff9800;
    }

    .periodo-separador.tarde i {
      color: #2196f3;
    }

    .periodo-separador .periodo-titulo {
      color: #2c3e50;
      font-size: 1rem;
      margin: 0;
    }

    .periodo-separador .periodo-subtitulo {
      color: #666;
      font-size: 0.85rem;
      margin: 0;
      font-weight: normal;
    }

    .periodo-conteudo {
      padding: 15px 20px;
      transition: all 0.3s ease;
    }

    .periodo-conteudo.manha {
      background-color: #fffaf5;
    }

    .periodo-conteudo.tarde {
      background-color: #f5f9ff;
    }

    .periodo-conteudo:empty {
      padding: 0;
    }

    .periodo-conteudo:empty + .periodo-separador {
      margin-top: 0;
    }

    /* Estilos para os cards de resumo */
    .icon-box {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .card {
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-5px);
    }

    .card:hover .icon-box {
        transform: scale(1.1);
    }

    /* Estilos para os t√≠tulos dos cards */
    .card-title {
        font-size: 1.1rem;
        font-weight: 500;
    }

    .card-text {
        font-size: 1.8rem;
        font-weight: 600;
    }

    /* Estilos para a tabela */
    .table {
        margin-bottom: 0;
    }

    .table thead th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
        padding: 1rem;
        background-color: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
    }

    .table tbody td {
        padding: 1rem;
        vertical-align: middle;
    }

    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }

    /* Estilos para os badges de status */
    .badge {
        padding: 0.5em 0.8em;
        font-weight: 500;
        font-size: 0.85rem;
    }

    /* Estilos para os filtros */
    #filtrosTabela .form-label {
        font-size: 0.9rem;
        font-weight: 500;
        color: #6c757d;
    }

    #filtrosTabela .form-select,
    #filtrosTabela .form-control {
        font-size: 0.9rem;
        border-radius: 0.5rem;
        border: 1px solid #dee2e6;
        padding: 0.5rem 1rem;
    }

    #filtrosTabela .form-select:focus,
    #filtrosTabela .form-control:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    /* Estilos para o contador de resultados */
    #contadorResultados {
        font-size: 0.9rem;
        color: #6c757d;
    }

    /* Estilos para os gr√°ficos */
    .card-body canvas {
        max-width: 100%;
        height: auto !important;
    }

    /* Atualiza√ß√£o dos estilos dos cards */
    .card.bg-primary {
        transition: all 0.3s ease;
    }

    .card.bg-primary:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }

    .card.bg-primary .icon-box {
        background-color: rgba(255, 255, 255, 0.1) !important;
        transition: all 0.3s ease;
    }

    .card.bg-primary:hover .icon-box {
        transform: scale(1.1);
        background-color: rgba(255, 255, 255, 0.2) !important;
    }

    .card.bg-primary .card-title {
        color: #ffffff;
        font-size: 1.1rem;
        font-weight: 500;
    }

    .card.bg-primary .card-text {
        color: #ffffff;
        font-size: 1.8rem;
        font-weight: 600;
    }

    /* Estilos para os filtros dentro dos cards azuis */
    .card.bg-primary #filtrosTabela .form-label {
        color: #ffffff;
    }

    .card.bg-primary #filtrosTabela .form-select,
    .card.bg-primary #filtrosTabela .form-control {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #ffffff;
    }

    .card.bg-primary #filtrosTabela .form-select option {
        background-color: #0d6efd;
        color: #ffffff;
    }

    .card.bg-primary #filtrosTabela .form-select:focus,
    .card.bg-primary #filtrosTabela .form-control:focus {
        background-color: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
        color: #ffffff;
        box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.1);
    }

    /* Ajuste para a tabela dentro do card azul */
    .card.bg-primary .table {
        color: #ffffff;
    }

    .card.bg-primary .table thead th {
        background-color: rgba(255, 255, 255, 0.1);
        color: #ffffff;
        border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    }

    .card.bg-primary .table tbody td {
        border-color: rgba(255, 255, 255, 0.1);
    }

    .card.bg-primary .table-hover tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }

    /* Ajuste para o contador de resultados */
    .card.bg-primary #contadorResultados {
        color: rgba(255, 255, 255, 0.8);
    }

    /* Ajuste para os gr√°ficos */
    .card.bg-primary canvas {
        filter: brightness(1.1);
    }

    /* Estilo para o placeholder do campo de busca */
    #filtroBusca::placeholder {
        color: rgba(255, 255, 255, 0.7) !important;
    }

    /* Ajuste das cores dos status */
    .badge.status-cancelada {
        background-color: #dc3545 !important; /* Vermelho */
        color: white !important;
    }

    .badge.status-concluida,
    .badge.status-conclu√çda {
        background-color: #198754 !important; /* Verde */
        color: white !important;
    }

    .badge.status-agendada {
        background-color: #0d6efd !important; /* Azul */
        color: white !important;
    }

    /* Ajuste das cores das linhas da tabela */
    .table tr.status-concluida,
    .table tr.status-conclu√çda {
        background-color: rgba(25, 135, 84, 0.1) !important;
    }

    .table tr.status-cancelada {
        background-color: rgba(220, 53, 69, 0.1) !important;
    }

    .table tr.status-agendada {
        background-color: rgba(13, 110, 253, 0.1) !important;
    }

    .table tr:hover.status-concluida,
    .table tr:hover.status-conclu√çda {
        background-color: rgba(25, 135, 84, 0.2) !important;
    }

    .table tr:hover.status-cancelada {
        background-color: rgba(220, 53, 69, 0.2) !important;
    }

    .table tr:hover.status-agendada {
        background-color: rgba(13, 110, 253, 0.2) !important;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark custom-navbar fixed-top bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#">Odonto Vida - Dentista</a>
    <div class="ms-auto">
      <a href="index.html" class="btn btn-outline-light" onclick="localStorage.clear()">Sair</a>
    </div>
  </div>
</nav>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 sidebar">
      <a onclick="carregarConteudo('visaoGeral', this)" class="active">
        <i class="fas fa-chart-line"></i> Vis√£o Geral
      </a>
      <a onclick="carregarConteudo('calendario', this)">
        <i class="fas fa-calendar"></i> Calend√°rio
      </a>
      <a onclick="carregarConteudo('relatorios', this)">
        <i class="fas fa-file-alt"></i> Relat√≥rios
      </a>
      <a onclick="carregarConteudo('conta', this)">
        <i class="fas fa-user"></i> Perfil
      </a>
      <hr>
    </div>

    <!-- Conte√∫do -->
    <div class="col-md-10 content">
      <div id="conteudo-dinamico">
        <!-- Conte√∫do inicial da Vis√£o Geral -->
        <div id="visao-geral">
          <h2 class="saudacao">
            <i class="bi bi-person-circle"></i>
            <span id="saudacaoFuncionario">Bem-vindo, Dr(a). ${nomeFuncionario}!</span>
          </h2>
          <p class="text-muted mb-4">Aqui voc√™ pode visualizar e gerenciar seus agendamentos.</p>

          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">
                    <i class="bi bi-calendar-check"></i>
                    Consultas
                  </h5>
                  <div class="date-selector">
                    <i class="bi bi-calendar-date"></i>
                    <select id="dataConsulta" class="form-select" onchange="atualizarConsultas()">
                      <!-- Op√ß√µes ser√£o preenchidas via JavaScript -->
                    </select>
                  </div>
                  <div id="consultasHoje" class="mt-3">
                    <div class="text-center">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card shadow-sm proximo-agendamento">
                <div class="card-body">
                  <h5 class="card-title">
                    <i class="bi bi-calendar-event"></i>
                    Pr√≥ximo Agendamento
                  </h5>
                  <div id="proximoAgendamento" class="mt-3">
                    <div class="text-center">
                      <div class="spinner-border text-light" role="status">
                        <span class="visually-hidden">Carregando...</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Conte√∫do do Calend√°rio -->
        <div id="calendario-view" style="display: none;">
          <h2 class="saudacao">
            <i class="bi bi-calendar3"></i>
            Calend√°rio de Consultas
          </h2>
          <p class="text-muted mb-4">Visualize sua agenda completa e o movimento di√°rio.</p>

          <div class="calendario-legenda">
            <div class="legenda-item">
              <div class="legenda-cor folga"></div>
              <div>
                <div class="legenda-texto">Folga</div>
                <div class="legenda-descricao">Finais de semana e feriados</div>
              </div>
            </div>
            <div class="legenda-item">
              <div class="legenda-cor normal"></div>
              <div>
                <div class="legenda-texto">Movimento Normal</div>
                <div class="legenda-descricao">1-3 consultas no dia</div>
              </div>
            </div>
            <div class="legenda-item">
              <div class="legenda-cor cheio"></div>
              <div>
                <div class="legenda-texto">Alta Demanda</div>
                <div class="legenda-descricao">Mais de 3 consultas</div>
              </div>
            </div>
            <div class="legenda-item">
              <div class="legenda-cor vazio"></div>
              <div>
                <div class="legenda-texto">Sem Consultas</div>
                <div class="legenda-descricao">Dia √∫til sem agendamentos</div>
              </div>
            </div>
          </div>
          <div id="calendar"></div>
        </div>

        <!-- Conte√∫do da Conta -->
        <div id="conta-view" style="display: none;">
          <h2 class="saudacao">
            <i class="fas fa-user-circle"></i>
            Meu Perfil
          </h2>
          <p class="text-muted mb-4">Gerencie suas informa√ß√µes pessoais.</p>
          <div id="mensagemStatus" class="alert" style="display: none;"></div>
          <div id="conta-content"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Adicionar o modal de confirma√ß√£o de exclus√£o no HTML, antes do fechamento do body -->
<div class="modal fade" id="modalExclusaoConta" tabindex="-1" aria-labelledby="modalExclusaoContaLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalExclusaoContaLabel">Confirmar Exclus√£o</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="text-danger">‚ö†Ô∏è Aten√ß√£o! Esta a√ß√£o n√£o pode ser desfeita.</p>
        <p>Tem certeza que deseja excluir sua conta? Todos os seus agendamentos ser√£o cancelados e os pacientes ser√£o notificados.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-danger" onclick="excluirConta()">
          <i class="fas fa-trash"></i> Sim, Excluir Conta
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Script para exibir nome do funcion√°rio e carregar dados -->
<script>
  const nomeFuncionario = localStorage.getItem("nomeFuncionario");
  const idFuncionario = localStorage.getItem("idFuncionario");
  
  // Atualizar sauda√ß√£o assim que o script carregar
  if (nomeFuncionario) {
    document.getElementById("saudacaoFuncionario").innerText = `Bem-vindo, Dr(a). ${nomeFuncionario}!`;
  }

  // Fun√ß√£o para formatar data e hora
  function formatarDataHora(dataHora) {
    // Separa a data e hora para formatar separadamente
    const [data, hora] = dataHora.split('T');
    const [ano, mes, dia] = data.split('-');
    
    // Formata a data no padr√£o brasileiro
    const dataFormatada = `${dia}/${mes}/${ano}`;
    
    // Retorna a data e hora formatadas, mantendo o hor√°rio original
    return `${dataFormatada} ${hora}`;
  }

  // Fun√ß√£o para gerar op√ß√µes de data
  function gerarOpcoesData() {
    const select = document.getElementById("dataConsulta");
    
    // Usar a data atual como refer√™ncia
    const hoje = new Date();
    
    // Limpar op√ß√µes existentes
    select.innerHTML = '';
    
    // Set para armazenar datas √∫nicas
    const datasUnicas = new Set();
    
    // Fun√ß√£o para verificar se √© dia √∫til (segunda a sexta)
    function isDiaUtil(data) {
      const diaSemana = data.getDay();
      return diaSemana !== 0 && diaSemana !== 6; // 0 = domingo, 6 = s√°bado
    }
    
    // Adiciona dias √∫teis at√© completar 7 dias √∫teis
    let diasAdicionados = 0;
    let diasVerificados = 0;
    
    while (diasAdicionados < 7 && diasVerificados < 14) { // Limite de 14 dias para evitar loop infinito
      const data = new Date(hoje);
      data.setDate(hoje.getDate() + diasVerificados);
      
      if (isDiaUtil(data)) {
        // Formata a data no fuso hor√°rio local
        const dataFormatada = data.toLocaleDateString('pt-BR', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          timeZone: 'America/Sao_Paulo'
        }).split('/').reverse().join('-');
        datasUnicas.add(dataFormatada);
        diasAdicionados++;
      }
      
      diasVerificados++;
    }
    
    // Converte o Set para Array e ordena as datas
    const datasOrdenadas = Array.from(datasUnicas).sort();
    
    // Adiciona as op√ß√µes ao select
    datasOrdenadas.forEach(dataStr => {
      const data = new Date(dataStr + 'T00:00:00-03:00');
      const dataExibicao = data.toLocaleDateString('pt-BR', {
        weekday: 'long',
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        timeZone: 'America/Sao_Paulo'
      });
      
      const option = document.createElement('option');
      option.value = dataStr;
      option.textContent = dataExibicao.charAt(0).toUpperCase() + dataExibicao.slice(1);
      select.appendChild(option);
    });
    
    // Seleciona a data atual por padr√£o (se for dia √∫til)
    const hojeFormatado = hoje.toLocaleDateString('pt-BR', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      timeZone: 'America/Sao_Paulo'
    }).split('/').reverse().join('-');
    
    // Se hoje n√£o for dia √∫til, seleciona o pr√≥ximo dia √∫til
    if (!isDiaUtil(hoje)) {
      let proximoDiaUtil = new Date(hoje);
      do {
        proximoDiaUtil.setDate(proximoDiaUtil.getDate() + 1);
      } while (!isDiaUtil(proximoDiaUtil));
      
      const proximoDiaUtilFormatado = proximoDiaUtil.toLocaleDateString('pt-BR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        timeZone: 'America/Sao_Paulo'
      }).split('/').reverse().join('-');
      
      const optionProximoDiaUtil = Array.from(select.options).find(option => option.value === proximoDiaUtilFormatado);
      if (optionProximoDiaUtil) {
        optionProximoDiaUtil.selected = true;
      }
    } else {
      const optionHoje = Array.from(select.options).find(option => option.value === hojeFormatado);
      if (optionHoje) {
        optionHoje.selected = true;
      }
    }
  }

  // Fun√ß√£o para atualizar consultas baseado na data selecionada
  async function atualizarConsultas() {
    const dataSelecionada = document.getElementById("dataConsulta").value;
    await carregarConsultasPorData(dataSelecionada);
  }

  // Fun√ß√£o para determinar o status da consulta
  function determinarStatusConsulta(consulta) {
    const dataConsulta = new Date(consulta.data + 'T' + consulta.horario);
    const agora = new Date();
    
    // Se a consulta j√° foi cancelada, verificar se foi cancelamento tardio
    if (consulta.status === "CANCELADA") {
      const dataCancelamento = new Date(consulta.dataCancelamento);
      const diferencaHoras = (dataConsulta - dataCancelamento) / (1000 * 60 * 60);
      return diferencaHoras < 24 ? "cancelamento-tardio" : "cancelada";
    }
    
    // Se a consulta j√° passou e n√£o foi cancelada, est√° conclu√≠da
    if (dataConsulta < agora) {
      return "concluida";
    }
    
    // Se n√£o √© nenhum dos casos acima, est√° agendada
    return "agendada";
  }

  // Fun√ß√£o para obter o √≠cone do status
  function getStatusIcon(status) {
    switch (status) {
      case "agendada":
        return "üïí";
      case "concluida":
        return "‚úÖ";
      case "cancelada":
        return "‚ùå";
      case "cancelamento-tardio":
        return "‚ö†Ô∏è";
      default:
        return "‚ùì";
    }
  }

  // Fun√ß√£o para obter o texto do status
  function getStatusText(status) {
    switch (status) {
      case "agendada":
        return "Agendada";
      case "concluida":
        return "Conclu√≠da";
      case "cancelada":
        return "Cancelada";
      case "cancelamento-tardio":
        return "Cancelada (Menos de 24h)";
      default:
        return "Desconhecido";
    }
  }

  function getStatusClass(status) {
    switch (status) {
      case "agendada":
        return "status-agendada";
      case "concluida":
        return "status-concluida";
      case "cancelada":
        return "status-cancelada";
      case "cancelamento-tardio":
        return "status-cancelamento-tardio";
      default:
        return "";
    }
  }

  // Cache para armazenar as consultas
  let cacheConsultas = null;
  let ultimaAtualizacao = null;
  const TEMPO_CACHE = 30000; // 30 segundos

  // Fun√ß√£o para buscar consultas com cache
  async function buscarConsultas() {
    const agora = new Date();
    
    // Se temos cache v√°lido, usa ele
    if (cacheConsultas && ultimaAtualizacao && (agora - ultimaAtualizacao) < TEMPO_CACHE) {
      console.log("Usando cache de consultas");
      return cacheConsultas;
    }

    console.log("Buscando consultas do servidor");
    try {
      const response = await fetch("http://localhost:8080/consultas/listar");
      
      if (!response.ok) {
        throw new Error("Erro ao buscar consultas");
      }

      const consultas = await response.json();
      
      // Atualiza o cache
      cacheConsultas = consultas;
      ultimaAtualizacao = agora;
      
      return consultas;
    } catch (error) {
      console.error("Erro ao buscar consultas:", error);
      throw error;
    }
  }

  // Fun√ß√£o para for√ßar atualiza√ß√£o do cache
  async function forcarAtualizacaoConsultas() {
    // Limpar cache atual
    cacheConsultas = null;
    ultimaAtualizacao = null;
    
    // Buscar consultas novamente
    try {
        const response = await fetch("http://localhost:8080/consultas/listar");
        if (!response.ok) {
            throw new Error("Erro ao buscar consultas");
        }
        const consultas = await response.json();
        
        // Atualizar cache
        cacheConsultas = consultas;
        ultimaAtualizacao = new Date();
        
        return consultas;
    } catch (error) {
        console.error("Erro ao for√ßar atualiza√ß√£o das consultas:", error);
        throw error;
    }
  }

  // Fun√ß√£o para carregar consultas por data
  async function carregarConsultasPorData(data) {
    const consultasHojeDiv = document.getElementById("consultasHoje");
    
    try {
      console.log("Carregando consultas para a data:", data);
      
      // Mostra loading
      consultasHojeDiv.innerHTML = `
        <div class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
        </div>`;

      const todasConsultas = await buscarConsultas();
      
      // Filtrar consultas da data selecionada para o funcion√°rio logado
      let consultas = todasConsultas.filter(consulta => {
        const dataConsulta = new Date(consulta.data + 'T00:00:00-03:00');
        const dataConsultaFormatada = dataConsulta.toLocaleDateString('pt-BR', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          timeZone: 'America/Sao_Paulo'
        }).split('/').reverse().join('-');
        
        const nomeDrConsulta = consulta.dr.split(' - ')[0];
        const nomeDrLogado = `Dr(a) ${nomeFuncionario}`;
        
        return dataConsultaFormatada === data && nomeDrConsulta === nomeDrLogado;
      });

      // Determinar status para cada consulta
      consultas = consultas.map(consulta => ({
        ...consulta,
        status: determinarStatusConsulta(consulta)
      }));

      // Criar um mapa para controlar os hor√°rios ocupados
      const horariosOcupados = new Map();

      // Primeiro, processar todas as consultas ativas (n√£o canceladas)
      consultas.forEach(consulta => {
        if (consulta.status !== 'cancelada' && consulta.status !== 'cancelamento-tardio') {
          horariosOcupados.set(consulta.horario, consulta);
        }
      });

      // Depois, adicionar apenas as consultas canceladas que n√£o t√™m substitui√ß√£o
      consultas.forEach(consulta => {
        if ((consulta.status === 'cancelada' || consulta.status === 'cancelamento-tardio') && 
            !horariosOcupados.has(consulta.horario)) {
          horariosOcupados.set(consulta.horario, consulta);
        }
      });

      // Converter o mapa de volta para array
      consultas = Array.from(horariosOcupados.values());

      if (consultas.length === 0) {
        consultasHojeDiv.innerHTML = `
          <div class="text-center py-4">
            <i class="bi bi-calendar-x text-muted" style="font-size: 2rem;"></i>
            <p class="text-muted mt-2">Nenhuma consulta agendada para esta data.</p>
          </div>`;
        return;
      }

      // Separar consultas em manh√£ e tarde
      const consultasManha = consultas.filter(c => {
        const hora = parseInt(c.horario.split(':')[0]);
        return hora >= 8 && hora < 12;
      });

      const consultasTarde = consultas.filter(c => {
        const hora = parseInt(c.horario.split(':')[0]);
        return hora >= 12 && hora < 18;
      });

      // Ordenar consultas por hor√°rio
      consultasManha.sort((a, b) => a.horario.localeCompare(b.horario));
      consultasTarde.sort((a, b) => a.horario.localeCompare(b.horario));

      let html = '<div class="card-consultas">';

      // Renderizar consultas da manh√£
      if (consultasManha.length > 0) {
        html += `
          <div class="periodo-separador manha">
            <i class="bi bi-sun-fill"></i>
            <div>
              <h6 class="periodo-titulo">Per√≠odo da Manh√£</h6>
              <p class="periodo-subtitulo">8:00 √†s 12:00</p>
            </div>
          </div>
          <div class="periodo-conteudo manha">
            <div class="list-group">
              ${consultasManha.map(consulta => renderizarConsulta(consulta)).join('')}
            </div>
          </div>`;
      }

      // Renderizar consultas da tarde
      if (consultasTarde.length > 0) {
        html += `
          <div class="periodo-separador tarde">
            <i class="bi bi-moon-fill"></i>
            <div>
              <h6 class="periodo-titulo">Per√≠odo da Tarde</h6>
              <p class="periodo-subtitulo">12:00 √†s 18:00</p>
            </div>
          </div>
          <div class="periodo-conteudo tarde">
            <div class="list-group">
              ${consultasTarde.map(consulta => renderizarConsulta(consulta)).join('')}
            </div>
          </div>`;
      }

      html += '</div>';
      
      consultasHojeDiv.innerHTML = html;
    } catch (error) {
      console.error("Erro ao carregar consultas:", error);
      consultasHojeDiv.innerHTML = `
        <div class="text-center py-4">
          <i class="bi bi-exclamation-triangle text-danger" style="font-size: 2rem;"></i>
          <p class="text-danger mt-2">Erro ao carregar consultas.</p>
          <button class="btn btn-outline-primary mt-2" onclick="forcarAtualizacaoConsultas().then(() => carregarConsultasPorData(document.getElementById('dataConsulta').value))">
            Tentar novamente
          </button>
        </div>`;
    }
  }

  // Fun√ß√£o auxiliar para renderizar uma consulta individual
  function renderizarConsulta(consulta) {
    const horarioFormatado = consulta.horario;
    const statusIcon = getStatusIcon(consulta.status);
    const statusText = getStatusText(consulta.status);
    
    return `
      <div class="list-group-item ${getStatusClass(consulta.status)}">
        <div class="d-flex w-100 justify-content-between align-items-center">
          <div>
            <div class="d-flex align-items-center gap-2 mb-2">
              <span class="badge badge-servico">${consulta.servico}</span>
              <span class="badge badge-status badge-${consulta.status}">
                ${statusIcon}
                ${statusText}
              </span>
            </div>
            <div class="paciente-info">
              <i class="bi bi-person"></i>
              ${consulta.nome}
            </div>
          </div>
          <span class="badge badge-horario">
            <i class="bi bi-clock"></i>
            ${horarioFormatado}
          </span>
        </div>
      </div>
    `;
  }

  // Fun√ß√£o para carregar pr√≥ximo agendamento
  async function carregarProximoAgendamento() {
    const proximoAgendamentoDiv = document.getElementById("proximoAgendamento");
    
    try {
      // Mostra loading
      proximoAgendamentoDiv.innerHTML = `
        <div class="text-center py-4">
          <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
        </div>`;

      const todasConsultas = await buscarConsultas();
      
      // Obt√©m a data e hora atual
      const agora = new Date();
      const horaAtual = agora.getHours();
      const minutoAtual = agora.getMinutes();
      
      // Define o hor√°rio de funcionamento
      const horaAbertura = 8; // 8:00
      const horaFechamento = 18; // 18:00
      
      // Filtrar consultas futuras do funcion√°rio logado, ignorando as canceladas
      const consultasFuturas = todasConsultas.filter(consulta => {
        // Extrair o nome do doutor da consulta
        const nomeDrConsulta = consulta.dr.split(' - ')[0];
        const nomeDrLogado = `Dr(a) ${nomeFuncionario}`;
        
        // Ignorar consultas canceladas
        if (consulta.status === "CANCELADA") {
          return false;
        }
        
        // Converte a data e hora da consulta para objeto Date
        const [ano, mes, dia] = consulta.data.split('-');
        const [hora, minuto] = consulta.horario.split(':');
        const dataConsulta = new Date(ano, mes - 1, dia, hora, minuto);
        
        // Se for hoje, s√≥ considera consultas ap√≥s o hor√°rio atual
        // Se for depois das 18h, considera apenas consultas do dia seguinte
        const ehHoje = dataConsulta.toDateString() === agora.toDateString();
        const horarioValido = !ehHoje || 
          (horaAtual < horaFechamento && 
           (hora > horaAtual || (hora === horaAtual && minuto > minutoAtual)));
        
        console.log("Analisando consulta:", {
          id: consulta.id,
          dataConsulta: dataConsulta.toLocaleString(),
          agora: agora.toLocaleString(),
          ehHoje,
          horarioValido,
          status: consulta.status,
          nomeDrConsulta,
          nomeDrLogado
        });
        
        return nomeDrConsulta === nomeDrLogado && 
               dataConsulta > agora && 
               horarioValido;
      });

      if (consultasFuturas.length === 0) {
        proximoAgendamentoDiv.innerHTML = `
          <div class="text-center py-4">
            <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
            <p class="mt-2">Nenhum agendamento futuro encontrado.</p>
          </div>`;
        return;
      }

      // Ordenar por data e hor√°rio
      consultasFuturas.sort((a, b) => {
        const dataA = new Date(a.data + 'T' + a.horario);
        const dataB = new Date(b.data + 'T' + b.horario);
        return dataA - dataB;
      });

      const proximo = consultasFuturas[0];
      const dataFormatada = formatarDataHora(proximo.data + 'T' + proximo.horario);
      const status = determinarStatusConsulta(proximo);
      
      proximoAgendamentoDiv.innerHTML = `
        <div class="card bg-transparent border-0">
          <div class="card-body p-0">
            <div class="d-flex align-items-center mb-3">
              <span class="badge bg-white text-primary me-2">
                <i class="bi bi-calendar3"></i>
                ${dataFormatada.split(' ')[0]}
              </span>
              <span class="badge bg-white text-primary">
                <i class="bi bi-clock"></i>
                ${proximo.horario}
              </span>
              <span class="badge bg-white text-primary ms-2">
                <i class="bi bi-info-circle"></i>
                ${getStatusText(status)}
              </span>
            </div>
            <h6 class="card-subtitle mb-3">${proximo.servico}</h6>
            <div class="paciente-info">
              <i class="bi bi-person-circle"></i>
              <span>${proximo.nome}</span>
            </div>
          </div>
        </div>
      `;
    } catch (error) {
      console.error("Erro ao carregar pr√≥ximo agendamento:", error);
      proximoAgendamentoDiv.innerHTML = `
        <div class="text-center py-4">
          <i class="bi bi-exclamation-triangle" style="font-size: 2rem;"></i>
          <p class="mt-2">Erro ao carregar pr√≥ximo agendamento.</p>
          <button class="btn btn-outline-light mt-2" onclick="forcarAtualizacaoConsultas().then(() => carregarProximoAgendamento())">
            Tentar novamente
          </button>
        </div>`;
    }
  }

  // Fun√ß√£o para carregar o calend√°rio
  async function carregarCalendario() {
    // Lista de feriados (exemplo - voc√™ pode adicionar mais)
    const feriados = [
      '2025-01-01', // Ano Novo
      '2025-04-18', // Sexta-feira Santa
      '2025-04-21', // Tiradentes
      '2025-05-01', // Dia do Trabalho
      '2025-09-07', // Independ√™ncia
      '2025-10-12', // Nossa Senhora Aparecida
      '2025-11-02', // Finados
      '2025-11-15', // Proclama√ß√£o da Rep√∫blica
      '2025-12-25'  // Natal
    ];

    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'pt-br',
      headerToolbar: {
        start: 'prev,next',
        center: 'title',
        end: 'today'
      },
      buttonText: {
        today: 'Hoje'
      },
      height: 'auto',
      dayMaxEvents: 3,
      eventTimeFormat: {
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      },
      eventDisplay: 'block',
      eventDidMount: function(info) {
        // Adicionar tooltip personalizado
        const tooltip = document.createElement('div');
        tooltip.className = 'fc-event-tooltip';
        tooltip.innerHTML = `
          <strong>${info.event.title}</strong><br>
          ${info.event.extendedProps.descricao || ''}
        `;
        
        info.el.addEventListener('mouseenter', (e) => {
          document.body.appendChild(tooltip);
          const rect = info.el.getBoundingClientRect();
          tooltip.style.position = 'fixed';
          tooltip.style.left = rect.left + 'px';
          tooltip.style.top = (rect.bottom + 5) + 'px';
        });
        
        info.el.addEventListener('mouseleave', () => {
          tooltip.remove();
        });
      },
      dayCellDidMount: function(info) {
        const hoje = new Date();
        hoje.setHours(0, 0, 0, 0);
        const dataCell = new Date(info.date);
        dataCell.setHours(0, 0, 0, 0);

        // Se o dia √© anterior a hoje, adiciona a classe de dia passado
        if (dataCell < hoje) {
          info.el.classList.add('fc-day-past');
          return;
        }

        // Verifica se √© final de semana (0 = domingo, 6 = s√°bado)
        const diaSemana = dataCell.getDay();
        const ehFinalSemana = diaSemana === 0 || diaSemana === 6;

        // Verifica se √© feriado
        const dataFormatada = dataCell.toISOString().split('T')[0];
        const ehFeriado = feriados.includes(dataFormatada);

        // Se for final de semana ou feriado, marca como folga
        if (ehFinalSemana || ehFeriado) {
          info.el.classList.add('movimento-folga');
          return;
        }

        // Para dias √∫teis, verifica o n√∫mero de consultas ativas (n√£o canceladas)
        const consultasDoDia = cacheConsultas.filter(c => 
          c.data === dataFormatada && 
          c.dr.split(' - ')[0] === `Dr(a) ${nomeFuncionario}` &&
          c.status !== 'CANCELADA'
        );

        if (consultasDoDia.length === 0) {
          info.el.classList.add('movimento-vazio');
        } else if (consultasDoDia.length <= 3) {
          info.el.classList.add('movimento-normal');
        } else {
          info.el.classList.add('movimento-cheio');
        }
      }
    });

    // Carregar eventos do calend√°rio
    async function carregarEventosCalendario() {
      try {
        const consultas = await buscarConsultas();
        const eventos = consultas
          .filter(consulta => {
            // Filtra apenas consultas do funcion√°rio logado e que n√£o estejam canceladas
            const nomeDrConsulta = consulta.dr.split(' - ')[0];
            const nomeDrLogado = `Dr(a) ${nomeFuncionario}`;
            return nomeDrConsulta === nomeDrLogado && consulta.status !== 'CANCELADA';
          })
          .map(consulta => ({
            title: `${consulta.horario} - ${consulta.nome}`,
            start: `${consulta.data}T${consulta.horario}`,
            backgroundColor: '#0d6efd',
            borderColor: '#0d6efd',
            textColor: '#ffffff',
            extendedProps: {
              descricao: `${consulta.servico}\nStatus: ${getStatusText(determinarStatusConsulta(consulta))}`
            }
          }));

        calendar.removeAllEvents();
        calendar.addEventSource(eventos);
      } catch (error) {
        console.error('Erro ao carregar eventos:', error);
      }
    }

    // Carregar eventos iniciais
    await carregarEventosCalendario();
    calendar.render();

    // Atualizar eventos periodicamente
    setInterval(carregarEventosCalendario, TEMPO_CACHE);
  }

  // Fun√ß√£o para carregar conte√∫do din√¢mico
  async function carregarConteudo(secao, linkElement) {
    // Remove active class from all links
    document.querySelectorAll('.sidebar a').forEach(link => {
        link.classList.remove('active');
    });
    
    // Add active class to clicked link
    if (linkElement) {
        linkElement.classList.add('active');
    }

    const visaoGeral = document.getElementById('visao-geral');
    const calendarioView = document.getElementById('calendario-view');
    const contaView = document.getElementById('conta-view');
    const conteudoDinamico = document.getElementById('conteudo-dinamico');

    // Esconder todas as se√ß√µes primeiro
    visaoGeral.style.display = 'none';
    calendarioView.style.display = 'none';
    contaView.style.display = 'none';

    // Criar ou obter a se√ß√£o de relat√≥rios
    let relatoriosView = document.getElementById('relatorios-view');
    if (!relatoriosView) {
        relatoriosView = document.createElement('div');
        relatoriosView.id = 'relatorios-view';
        relatoriosView.style.display = 'none';
        conteudoDinamico.appendChild(relatoriosView);
    }
    relatoriosView.style.display = 'none';

    // Carregar o conte√∫do apropriado
    if (secao === "visaoGeral") {
        visaoGeral.style.display = 'block';
        await forcarAtualizacaoConsultas();
        await Promise.all([
            carregarConsultasPorData(document.getElementById("dataConsulta").value),
            carregarProximoAgendamento()
        ]);
    } else if (secao === "calendario") {
        calendarioView.style.display = 'block';
        await carregarCalendario();
    } else if (secao === "conta") {
        contaView.style.display = 'block';
        await carregarConta();
    } else if (secao === "relatorios") {
        // Garantir que o conte√∫do da se√ß√£o de relat√≥rios seja criado
        if (!relatoriosView.innerHTML.trim()) {
            // Criar o conte√∫do HTML da se√ß√£o de relat√≥rios
            const relatoriosHTML = `
                <div class="divisor-secao">
                    <h2 class="saudacao">
                        <i class="bi bi-file-earmark-bar-graph"></i>
                        Relat√≥rio de Consultas
                    </h2>
                    <p class="text-muted mb-4">Visualize e analise o desempenho das suas consultas.</p>
                    
                    <!-- Filtros -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <form id="formFiltroRelatorio" class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">Tipo de Per√≠odo</label>
                                    <select class="form-select" id="tipoPeriodo" onchange="atualizarFiltrosPeriodo()">
                                        <option value="diario">Di√°rio</option>
                                        <option value="semanal">Semanal</option>
                                        <option value="mensal">Mensal</option>
                                        <option value="anual">Anual</option>
                                        <option value="personalizado">Personalizado</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-3" id="filtroDataInicial">
                                    <label class="form-label">Data Inicial</label>
                                    <input type="date" class="form-control" id="dataInicial">
                                </div>
                                
                                <div class="col-md-3" id="filtroDataFinal">
                                    <label class="form-label">Data Final</label>
                                    <input type="date" class="form-control" id="dataFinal">
                                </div>
                                
                                <div class="col-md-3 d-flex align-items-end">
                                    <button type="button" class="btn bg-primary text-white w-100" onclick="gerarRelatorioConsultas()">
                                        <i class="fas fa-search me-2"></i>Gerar Relat√≥rio
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Cards de Resumo -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card h-100 border-0 shadow-sm bg-primary">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title text-white mb-0">Total de Consultas</h6>
                                            <h2 class="card-text text-white mt-2 mb-0" id="totalConsultas">0</h2>
                                        </div>
                                        <div class="icon-box bg-white bg-opacity-10 rounded-circle p-3">
                                            <i class="bi bi-calendar-check text-white" style="font-size: 1.5rem;"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card h-100 border-0 shadow-sm bg-primary">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title text-white mb-0">Taxa de Comparecimento</h6>
                                            <h2 class="card-text text-white mt-2 mb-0" id="taxaComparecimento">0%</h2>
                                        </div>
                                        <div class="icon-box bg-white bg-opacity-10 rounded-circle p-3">
                                            <i class="bi bi-graph-up-arrow text-white" style="font-size: 1.5rem;"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card h-100 border-0 shadow-sm bg-primary">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title text-white mb-0">Hor√°rio Mais Popular</h6>
                                            <h2 class="card-text text-white mt-2 mb-0" id="horarioPopular">-</h2>
                                        </div>
                                        <div class="icon-box bg-white bg-opacity-10 rounded-circle p-3">
                                            <i class="bi bi-clock-history text-white" style="font-size: 1.5rem;"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card h-100 border-0 shadow-sm bg-primary">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title text-white mb-0">Servi√ßo Mais Solicitado</h6>
                                            <h2 class="card-text text-white mt-2 mb-0" id="servicoPopular">-</h2>
                                        </div>
                                        <div class="icon-box bg-white bg-opacity-10 rounded-circle p-3">
                                            <i class="bi bi-star text-white" style="font-size: 1.5rem;"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gr√°ficos -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm bg-primary">
                                <div class="card-body">
                                    <h5 class="card-title d-flex align-items-center mb-4 text-white">
                                        <i class="bi bi-bar-chart-line me-2 text-white"></i>
                                        Consultas por Per√≠odo
                                    </h5>
                                    <div style="height: 250px;">
                                        <canvas id="graficoConsultasPeriodo"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm bg-primary">
                                <div class="card-body">
                                    <h5 class="card-title d-flex align-items-center mb-4 text-white">
                                        <i class="bi bi-pie-chart me-2 text-white"></i>
                                        Taxa de Comparecimento
                                    </h5>
                                    <div style="height: 250px;">
                                        <canvas id="graficoComparecimento"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm bg-primary">
                                <div class="card-body">
                                    <h5 class="card-title d-flex align-items-center mb-4 text-white">
                                        <i class="bi bi-clock-history me-2 text-white"></i>
                                        Hor√°rios Mais Populares
                                    </h5>
                                    <div style="height: 250px;">
                                        <canvas id="graficoHorarios"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm bg-primary">
                                <div class="card-body">
                                    <h5 class="card-title d-flex align-items-center mb-4 text-white">
                                        <i class="bi bi-star me-2 text-white"></i>
                                        Servi√ßos Mais Solicitados
                                    </h5>
                                    <div style="height: 250px;">
                                        <canvas id="graficoServicos"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabela de Dados -->
                    <div class="card border-0 shadow-sm bg-primary">
                        <div class="card-body">
                            <h5 class="card-title d-flex align-items-center mb-4 text-white">
                                <i class="bi bi-table me-2 text-white"></i>
                                Dados Detalhados
                            </h5>
                            <div id="filtrosTabela" class="mb-3">
                                <!-- Filtros ser√£o inseridos aqui via JavaScript -->
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <small class="text-white" id="contadorResultados"></small>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Data</th>
                                            <th>Hor√°rio</th>
                                            <th>Paciente</th>
                                            <th>Servi√ßo</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaConsultasBody">
                                        <!-- Dados ser√£o inseridos via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Inserir o HTML na se√ß√£o de relat√≥rios
            relatoriosView.innerHTML = relatoriosHTML;
        }

        // Mostrar a se√ß√£o de relat√≥rios
        relatoriosView.style.display = 'block';
        
        // Inicializar os filtros de data e gerar relat√≥rio inicial
        await atualizarFiltrosPeriodo();
        await gerarRelatorioConsultas();
    }
  }

  // Adiciona listener para atualiza√ß√£o autom√°tica
  setInterval(async () => {
    if (document.getElementById("conteudo-dinamico").querySelector(".active")?.textContent.includes("Vis√£o Geral")) {
      console.log("Atualizando dados da vis√£o geral...");
      await forcarAtualizacaoConsultas();
      await Promise.all([
        carregarConsultasPorData(document.getElementById("dataConsulta").value),
        carregarProximoAgendamento()
      ]);
    }
  }, TEMPO_CACHE);

  // Carregar dados ao iniciar a p√°gina
  document.addEventListener('DOMContentLoaded', async () => {
    if (idFuncionario) {
      await forcarAtualizacaoConsultas(); // For√ßa primeira carga
      gerarOpcoesData();
      await Promise.all([
        carregarConsultasPorData(document.getElementById("dataConsulta").value),
        carregarProximoAgendamento()
      ]);
    } else {
      window.location.href = 'login-funcionario.html';
    }
  });

  // Fun√ß√£o para carregar e exibir os dados da conta
  async function carregarConta() {
    const contaContent = document.getElementById('conta-content');
    
    try {
      const response = await fetch(`http://localhost:8080/funcionarios/listar/${idFuncionario}`);
      if (!response.ok) {
        throw new Error("Erro ao buscar dados do funcion√°rio");
      }
      
      const funcionario = await response.json();
      
      contaContent.innerHTML = `
        <div class="card">
          <div class="card-body">
            <h5 class="card-title mb-4">Dados do Perfil</h5>
            <form id="formConta" onsubmit="return salvarAlteracoesConta(event)">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="nomeConta" value="${funcionario.nome}" required onchange="verificarAlteracoesConta()">
                    <label for="nomeConta">Nome</label>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="form-floating">
                    <input type="email" class="form-control" id="emailConta" value="${funcionario.email}" required onchange="verificarAlteracoesConta()">
                    <label for="emailConta">E-mail</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="cpfConta" value="${funcionario.cpf}" disabled>
                    <label for="cpfConta">CPF</label>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="croConta" value="${funcionario.cro}" disabled>
                    <label for="croConta">CRO</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="form-floating position-relative">
                    <input type="password" class="form-control" id="senhaAtual" value="${funcionario.senha}" onchange="verificarAlteracoesConta()">
                    <label for="senhaAtual">Senha Atual</label>
                    <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y" onclick="togglePasswordVisibility('senhaAtual')">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="form-floating position-relative">
                    <input type="password" class="form-control" id="novaSenha" placeholder="Nova senha" onchange="verificarAlteracoesConta()">
                    <label for="novaSenha">Nova Senha (opcional)</label>
                    <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y" onclick="togglePasswordVisibility('novaSenha')">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="d-flex gap-2 mt-4">
                <button type="submit" class="btn btn-primary" id="btnSalvarConta" disabled>
                  <i class="fas fa-save"></i> Salvar Altera√ß√µes
                </button>
                <button type="button" class="btn btn-danger" onclick="confirmarExclusaoConta()">
                  <i class="fas fa-trash"></i> Excluir Conta
                </button>
              </div>
            </form>
          </div>
        </div>
      `;

      // Armazenar valores originais para compara√ß√£o
      window.valoresOriginaisConta = {
        nome: funcionario.nome,
        email: funcionario.email,
        cpf: funcionario.cpf,
        cro: funcionario.cro,
        senha: funcionario.senha
      };
    } catch (error) {
      console.error("Erro ao carregar dados da conta:", error);
      contaContent.innerHTML = `
        <div class="alert alert-danger">
          Erro ao carregar dados da conta: ${error.message}
        </div>
      `;
    }
  }

  function togglePasswordVisibility(inputId) {
    const input = document.getElementById(inputId);
    const icon = input.nextElementSibling.nextElementSibling.querySelector('i');
    
    if (input.type === 'password') {
      input.type = 'text';
      icon.classList.remove('fa-eye');
      icon.classList.add('fa-eye-slash');
    } else {
      input.type = 'password';
      icon.classList.remove('fa-eye-slash');
      icon.classList.add('fa-eye');
    }
  }

  function verificarAlteracoesConta() {
    const btnSalvar = document.getElementById("btnSalvarConta");
    const nome = document.getElementById("nomeConta").value;
    const email = document.getElementById("emailConta").value;
    const senhaAtual = document.getElementById("senhaAtual").value;
    const novaSenha = document.getElementById("novaSenha").value;

    const houveAlteracao = 
      nome !== window.valoresOriginaisConta.nome ||
      email !== window.valoresOriginaisConta.email ||
      senhaAtual !== window.valoresOriginaisConta.senha ||
      novaSenha !== "";

    btnSalvar.disabled = !houveAlteracao;
  }

  async function salvarAlteracoesConta(e) {
    e.preventDefault();

    const senhaAtual = document.getElementById("senhaAtual").value;
    const novaSenha = document.getElementById("novaSenha").value;

    if (novaSenha && novaSenha === senhaAtual) {
      const mensagemStatus = document.getElementById("mensagemStatus");
      mensagemStatus.textContent = "‚ùå A nova senha n√£o pode ser igual √† senha atual.";
      mensagemStatus.className = "alert alert-danger";
      mensagemStatus.style.display = "block";
      return false;
    }

    const dadosAtualizados = {
      id: parseInt(idFuncionario),
      nome: document.getElementById("nomeConta").value,
      email: document.getElementById("emailConta").value,
      cpf: document.getElementById("cpfConta").value,
      cro: document.getElementById("croConta").value,
      senha: novaSenha || senhaAtual
    };

    try {
      const response = await fetch(`http://localhost:8080/funcionarios/atualizar/${idFuncionario}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(dadosAtualizados)
      });

      if (!response.ok) {
        throw new Error("Erro ao atualizar dados");
      }

      const data = await response.json();
      
      // Se uma nova senha foi definida, fazer logout
      if (novaSenha) {
        const mensagemStatus = document.getElementById("mensagemStatus");
        mensagemStatus.textContent = "‚úÖ Senha alterada com sucesso! Por favor, fa√ßa login novamente com sua nova senha.";
        mensagemStatus.className = "alert alert-success";
        mensagemStatus.style.display = "block";
        
        // Limpar localStorage e redirecionar para a p√°gina de login ap√≥s 2 segundos
        setTimeout(() => {
          localStorage.clear();
          window.location.href = 'login-funcionario.html';
        }, 2000);
        return false;
      }

      const mensagemStatus = document.getElementById("mensagemStatus");
      mensagemStatus.textContent = "‚úÖ Dados atualizados com sucesso!";
      mensagemStatus.className = "alert alert-success";
      mensagemStatus.style.display = "block";
      
      // Limpar campo de nova senha
      document.getElementById("novaSenha").value = "";
      
      // Atualizar valores originais
      window.valoresOriginaisConta = {
        nome: data.nome,
        email: data.email,
        cpf: data.cpf,
        cro: data.cro,
        senha: data.senha
      };

      // Atualizar nome no cabe√ßalho
      document.getElementById("saudacaoFuncionario").innerText = `Bem-vindo, Dr(a). ${data.nome}!`;
      localStorage.setItem("nomeFuncionario", data.nome);
      
      // Recarregar a conta
      await carregarConta();
    } catch (error) {
      console.error("Erro ao atualizar dados:", error);
      const mensagemStatus = document.getElementById("mensagemStatus");
      mensagemStatus.textContent = "‚ùå Erro ao atualizar dados: " + error.message;
      mensagemStatus.className = "alert alert-danger";
      mensagemStatus.style.display = "block";
    }

    return false;
  }

  function confirmarExclusaoConta() {
    const modal = new bootstrap.Modal(document.getElementById('modalExclusaoConta'));
    modal.show();
  }

  async function excluirConta() {
    const mensagemStatus = document.getElementById("mensagemStatus");
    mensagemStatus.textContent = "Processando exclus√£o da conta...";
    mensagemStatus.className = "alert alert-info";
    mensagemStatus.style.display = "block";

    // Fun√ß√£o auxiliar para fazer requisi√ß√µes com timeout
    async function fetchWithTimeout(url, options, timeout = 10000) {
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), timeout);

        try {
            console.log(`Iniciando requisi√ß√£o para: ${url}`);
            const response = await fetch(url, {
                ...options,
                signal: controller.signal,
                headers: {
                    ...options.headers,
                    "Accept": "application/json",
                    "Content-Type": "application/json"
                },
                mode: "cors"
            });
            
            clearTimeout(id);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            console.log(`Requisi√ß√£o para ${url} conclu√≠da com sucesso`);
            return response;
        } catch (error) {
            clearTimeout(id);
            if (error.name === 'AbortError') {
                throw new Error(`Timeout ao acessar ${url}`);
            }
            throw error;
        }
    }

    try {
        console.log("=== Iniciando processo de exclus√£o da conta ===");
        console.log("ID do funcion√°rio:", idFuncionario);
        
        // Buscar dados do funcion√°rio
        console.log("1. Buscando dados do funcion√°rio...");
        const responseFuncionario = await fetchWithTimeout(
            `http://localhost:8080/funcionarios/listar/${idFuncionario}`,
            { method: "GET" }
        );
        
        const funcionario = await responseFuncionario.json();
        console.log("Dados do funcion√°rio obtidos:", funcionario);

        // Buscar todas as consultas
        console.log("2. Buscando consultas...");
        const responseConsultas = await fetchWithTimeout(
            "http://localhost:8080/consultas/listar",
            { method: "GET" }
        );
        
        const todasConsultas = await responseConsultas.json();
        console.log("Total de consultas encontradas:", todasConsultas.length);
        
        // Filtrar consultas do funcion√°rio
        console.log("3. Filtrando consultas do funcion√°rio...");
        const consultasDoFuncionario = todasConsultas.filter(consulta => {
            const nomeDrConsulta = consulta.dr.split(' - ')[0];
            return nomeDrConsulta === `Dr(a) ${funcionario.nome}` && consulta.pacienteId; // Verifica se tem pacienteId
        });
        console.log("Consultas do funcion√°rio encontradas:", consultasDoFuncionario.length);

        if (consultasDoFuncionario.length === 0) {
            console.log("Nenhuma consulta encontrada para o funcion√°rio");
            // Se n√£o houver consultas, apenas deleta a conta
            console.log("Deletando conta do funcion√°rio...");
            await fetchWithTimeout(
                `http://localhost:8080/funcionarios/deletar/${idFuncionario}`,
                { method: "DELETE" }
            );
            
            console.log("=== Processo de exclus√£o conclu√≠do com sucesso! ===");
            mensagemStatus.textContent = "‚úÖ Conta exclu√≠da com sucesso! Redirecionando...";
            mensagemStatus.className = "alert alert-success";
            mensagemStatus.style.display = "block";
            
            localStorage.clear();
            setTimeout(() => {
                window.location.href = "index.html";
            }, 2000);
            return;
        }

        // Agrupar consultas por paciente
        console.log("4. Agrupando consultas por paciente...");
        const consultasPorPaciente = new Map();
        consultasDoFuncionario.forEach(consulta => {
            if (!consulta.pacienteId) {
                console.warn(`Consulta ${consulta.id} n√£o tem pacienteId associado`);
                return;
            }
            if (!consultasPorPaciente.has(consulta.pacienteId)) {
                consultasPorPaciente.set(consulta.pacienteId, []);
            }
            consultasPorPaciente.get(consulta.pacienteId).push(consulta);
        });
        console.log("N√∫mero de pacientes afetados:", consultasPorPaciente.size);

        // Notificar cada paciente e atualizar suas consultas
        console.log("5. Processando notifica√ß√µes e atualiza√ß√µes...");
        for (const [idPaciente, consultas] of consultasPorPaciente) {
            if (!idPaciente) {
                console.warn("ID do paciente √© undefined, pulando...");
                continue;
            }

            try {
                console.log(`Processando paciente ${idPaciente}...`);
                
                // Buscar dados do paciente
                console.log(`5.1. Buscando dados do paciente ${idPaciente}...`);
                const responsePaciente = await fetchWithTimeout(
                    `http://localhost:8080/pacientes/listar/${idPaciente}`,
                    { method: "GET" }
                );
                
                const paciente = await responsePaciente.json();
                console.log(`Dados do paciente ${idPaciente} obtidos:`, paciente);

                // Criar notifica√ß√£o
                console.log(`5.2. Criando notifica√ß√£o para paciente ${idPaciente}...`);
                const notificacao = {
                    idPaciente: idPaciente,
                    titulo: "Consultas Canceladas",
                    mensagem: `Infelizmente o Dr(a) ${funcionario.nome} n√£o est√° mais dispon√≠vel no sistema.\n\nSuas consultas foram canceladas:\n${consultas.map(c => 
                        `- ${c.data} √†s ${c.horario}: ${c.servico}`
                    ).join('\n')}\n\nPor favor, entre em contato com a cl√≠nica para reagendar com outro especialista.`,
                    data: new Date().toISOString(),
                    lida: false
                };

                // Enviar notifica√ß√£o
                console.log(`5.3. Enviando notifica√ß√£o para paciente ${idPaciente}...`);
                await fetchWithTimeout(
                    "http://localhost:8080/notificacoes/criar",
                    {
                        method: "POST",
                        body: JSON.stringify(notificacao)
                    }
                );

                // Atualizar consultas
                console.log(`5.4. Atualizando consultas do paciente ${idPaciente}...`);
                for (const consulta of consultas) {
                    console.log(`Atualizando consulta ${consulta.id}...`);
                    
                    const consultaAtualizada = {
                        ...consulta,
                        status: "CANCELADA",
                        dataCancelamento: new Date().toISOString(),
                        motivoCancelamento: `Especialista Dr(a) ${funcionario.nome} n√£o est√° mais dispon√≠vel no sistema`
                    };

                    await fetchWithTimeout(
                        `http://localhost:8080/consultas/atualizar/${consulta.id}`,
                        {
                            method: "PUT",
                            body: JSON.stringify(consultaAtualizada)
                        }
                    );

                    console.log(`Consulta ${consulta.id} atualizada com sucesso`);
                }
            } catch (error) {
                console.error(`Erro ao processar paciente ${idPaciente}:`, error);
                // Continua o processo mesmo se houver erro em um paciente
                console.log(`Continuando processo apesar do erro no paciente ${idPaciente}`);
            }
        }

        // Deletar a conta
        console.log("6. Deletando conta do funcion√°rio...");
        await fetchWithTimeout(
            `http://localhost:8080/funcionarios/deletar/${idFuncionario}`,
            { method: "DELETE" }
        );

        console.log("=== Processo de exclus√£o conclu√≠do com sucesso! ===");

        mensagemStatus.textContent = "‚úÖ Conta exclu√≠da com sucesso! Redirecionando...";
        mensagemStatus.className = "alert alert-success";
        mensagemStatus.style.display = "block";
        
        // Limpar dados do localStorage
        localStorage.clear();
        
        // Redirecionar para a p√°gina inicial ap√≥s 2 segundos
        setTimeout(() => {
            window.location.href = "index.html";
        }, 2000);
    } catch (error) {
        console.error("=== Erro no processo de exclus√£o ===", error);
        let mensagemErro = "‚ùå Erro ao excluir conta: ";
        
        if (error.message.includes("Timeout")) {
            mensagemErro += "O servidor demorou muito para responder. Por favor, tente novamente.";
        } else if (error.message.includes("Failed to fetch")) {
            mensagemErro += "N√£o foi poss√≠vel conectar ao servidor. Por favor, verifique se o servidor est√° rodando e tente novamente.";
        } else if (error.message.includes("NetworkError")) {
            mensagemErro += "Erro de conex√£o com o servidor. Verifique sua internet e tente novamente.";
        } else if (error.message.includes("CORS")) {
            mensagemErro += "Erro de configura√ß√£o do servidor. Por favor, contate o administrador.";
        } else {
            mensagemErro += error.message;
        }
        
        mensagemStatus.textContent = mensagemErro;
        mensagemStatus.className = "alert alert-danger";
        mensagemStatus.style.display = "block";
    }
}

async function gerarRelatorioConsultas() {
    try {
        const tipoPeriodo = document.getElementById("tipoPeriodo").value;
        const dataInicio = document.getElementById("dataInicial").value;
        const dataFim = document.getElementById("dataFinal").value;
        const dentistaId = localStorage.getItem("idFuncionario"); // Pegar ID do dentista logado

        console.log("Par√¢metros do relat√≥rio:", { tipoPeriodo, dataInicio, dataFim, dentistaId });

        let url = "http://localhost:8080/consultas/listar";
        const params = new URLSearchParams();
        
        if (tipoPeriodo === "personalizado") {
            if (!dataInicio || !dataFim) {
                alert("Por favor, selecione as datas de in√≠cio e fim para o per√≠odo personalizado.");
                return;
            }
            params.append("dataInicio", dataInicio);
            params.append("dataFim", dataFim);
        }

        // Adicionar filtro por dentista
        params.append("dentistaId", dentistaId);

        url += "?" + params.toString();
        console.log("URL da requisi√ß√£o:", url);

        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Origin': 'http://127.0.0.1:5500'
            },
            mode: 'cors'
        });

        if (!response.ok) {
            throw new Error(`Erro ao buscar dados das consultas: ${response.status} ${response.statusText}`);
        }

        const consultas = await response.json();
        console.log("Total de consultas recebidas:", consultas.length);

        // Filtrar consultas pelo per√≠odo selecionado
        const consultasFiltradas = consultas.filter(consulta => {
            const dataConsulta = new Date(consulta.data);
            const dataInicioFiltro = new Date(dataInicio);
            const dataFimFiltro = new Date(dataFim);
            return dataConsulta >= dataInicioFiltro && dataConsulta <= dataFimFiltro;
        });

        console.log("Consultas filtradas para o per√≠odo:", consultasFiltradas.length);

        if (consultasFiltradas.length === 0) {
            alert("N√£o foram encontradas consultas para o per√≠odo selecionado.");
            return;
        }

        // Atualizar cards de resumo
        atualizarCardsResumo(consultasFiltradas);

        // Atualizar gr√°ficos
        atualizarGraficos(consultasFiltradas);

        // Atualizar tabela
        atualizarTabelaConsultas(consultasFiltradas);

    } catch (error) {
        console.error("Erro ao carregar relat√≥rio:", error);
        alert(`Erro ao carregar o relat√≥rio de consultas: ${error.message}`);
    }
}

function atualizarTabelaConsultas(consultas) {
    const tbody = document.querySelector("#tabelaConsultasBody");
    const filtrosContainer = document.querySelector("#filtrosTabela");
    
    if (!tbody || !filtrosContainer) {
        console.error("Elementos necess√°rios n√£o encontrados");
        return;
    }

    // For√ßar atualiza√ß√£o do cache antes de preencher os filtros
    forcarAtualizacaoConsultas().then(consultasAtualizadas => {
        // Armazenar as consultas globalmente para uso nos filtros
        window.consultasAtuais = consultasAtualizadas;

        // Criar filtros se ainda n√£o existirem
        if (!document.getElementById("filtroStatus")) {
            const filtrosHTML = `
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label text-white">Status</label>
                        <select class="form-select" id="filtroStatus" onchange="aplicarFiltrosTabela()">
                            <option value="">Todos</option>
                            <option value="CONCLU√çDA">Conclu√≠das</option>
                            <option value="AGENDADA">Agendadas</option>
                            <option value="CANCELADA">Canceladas</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-white">Servi√ßo</label>
                        <select class="form-select" id="filtroServico" onchange="aplicarFiltrosTabela()">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-white">Buscar</label>
                        <input type="text" class="form-control text-white" id="filtroBusca" 
                               placeholder="Buscar por paciente..." 
                               style="color: white !important;"
                               onkeyup="aplicarFiltrosTabela()">
                    </div>
                </div>
            `;
            filtrosContainer.innerHTML = filtrosHTML;

            // Preencher op√ß√µes dos filtros com as consultas atualizadas
            const servicos = [...new Set(consultasAtualizadas.map(c => c.servico).filter(Boolean))];
            const selectServico = document.getElementById("filtroServico");

            servicos.sort().forEach(servico => {
                selectServico.add(new Option(servico, servico));
            });
        }

        // Aplicar filtros iniciais
        aplicarFiltrosTabela();
    });
}

function aplicarFiltrosTabela() {
    const tbody = document.querySelector("#tabelaConsultasBody");
    if (!tbody || !window.consultasAtuais) return;

    const filtroStatus = document.getElementById("filtroStatus").value;
    const filtroServico = document.getElementById("filtroServico").value;
    const filtroBusca = document.getElementById("filtroBusca").value.toLowerCase();

    const agora = new Date();
    let html = '';
    
    const consultasFiltradas = window.consultasAtuais.filter(consulta => {
        // Determinar status atual
        const [ano, mes, dia] = consulta.data.split('-').map(Number);
        const [hora, minuto] = consulta.horario.split(':').map(Number);
        const dataHoraConsulta = new Date(ano, mes - 1, dia, hora, minuto);
        
        let status = consulta.status;
        if (status !== 'CANCELADA') {
            status = dataHoraConsulta < agora ? 'CONCLU√çDA' : 'AGENDADA';
        }

        // Aplicar filtros
        if (filtroStatus && status !== filtroStatus) return false;
        if (filtroServico && consulta.servico !== filtroServico) return false;
        if (filtroBusca && !consulta.nome?.toLowerCase().includes(filtroBusca)) return false;

        return true;
    });

    // Atualizar contador de resultados
    const contadorResultados = document.getElementById("contadorResultados");
    if (contadorResultados) {
        contadorResultados.textContent = `${consultasFiltradas.length} consulta${consultasFiltradas.length !== 1 ? 's' : ''} encontrada${consultasFiltradas.length !== 1 ? 's' : ''}`;
    }

    // Renderizar tabela
    consultasFiltradas.forEach(consulta => {
        const [ano, mes, dia] = consulta.data.split('-').map(Number);
        const [hora, minuto] = consulta.horario.split(':').map(Number);
        const dataHoraConsulta = new Date(ano, mes - 1, dia, hora, minuto);

        let status = consulta.status;
        if (status !== 'CANCELADA') {
            status = dataHoraConsulta < agora ? 'CONCLU√çDA' : 'AGENDADA';
        }

        // Normalizar o status para a classe CSS
        const statusClass = status.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');

        html += `
            <tr class="status-${statusClass}">
                <td>${consulta.data}</td>
                <td>${consulta.horario}</td>
                <td>${consulta.nome || '-'}</td>
                <td>${consulta.servico || '-'}</td>
                <td>
                    <span class="badge status-${statusClass}">
                        ${status}
                    </span>
                </td>
            </tr>
        `;
    });

    tbody.innerHTML = html;
}

// ... rest of the existing functions (atualizarFiltrosPeriodo, prepararDadosPorPeriodo, etc.) ...

// Fun√ß√µes para o relat√≥rio
function atualizarCardsResumo(consultas) {
    // Total de Consultas
    const totalConsultas = consultas.length;
    document.getElementById('totalConsultas').textContent = totalConsultas;

    // Taxa de Comparecimento
    const agora = new Date();
    const consultasConcluidas = consultas.filter(c => {
        const [ano, mes, dia] = c.data.split('-').map(Number);
        const [hora, minuto] = c.horario.split(':').map(Number);
        const dataHoraConsulta = new Date(ano, mes - 1, dia, hora, minuto);
        return dataHoraConsulta < agora && c.status !== 'CANCELADA';
    }).length;
    
    const taxaComparecimento = totalConsultas > 0 ? ((consultasConcluidas / totalConsultas) * 100).toFixed(1) : 0;
    document.getElementById('taxaComparecimento').textContent = `${taxaComparecimento}%`;

    // Hor√°rio Mais Popular
    const horarios = consultas.map(c => c.horario);
    const horarioPopular = encontrarMaisFrequente(horarios);
    document.getElementById('horarioPopular').textContent = horarioPopular || '-';

    // Servi√ßo Mais Solicitado
    const servicos = consultas.map(c => c.servico);
    const servicoPopular = encontrarMaisFrequente(servicos);
    document.getElementById('servicoPopular').textContent = servicoPopular || '-';
}

function encontrarMaisFrequente(array) {
    if (!array.length) return null;
    
    const contagem = {};
    let maxFreq = 0;
    let maisFrequente = null;

    array.forEach(item => {
        if (!item) return;
        contagem[item] = (contagem[item] || 0) + 1;
        if (contagem[item] > maxFreq) {
            maxFreq = contagem[item];
            maisFrequente = item;
        }
    });

    return maisFrequente;
}

function atualizarGraficos(consultas) {
    // Gr√°fico de Consultas por Per√≠odo
    const dadosPeriodo = prepararDadosPorPeriodo(consultas);
    criarGraficoConsultasPeriodo(dadosPeriodo.labels, dadosPeriodo.values);

    // Gr√°fico de Taxa de Comparecimento
    const dadosComparecimento = prepararDadosComparecimento(consultas);
    criarGraficoComparecimento(dadosComparecimento);

    // Gr√°fico de Hor√°rios Populares
    const dadosHorarios = prepararDadosHorarios(consultas);
    criarGraficoHorarios(dadosHorarios.labels, dadosHorarios.values);

    // Gr√°fico de Servi√ßos Populares
    const dadosServicos = prepararDadosServicos(consultas);
    criarGraficoServicos(dadosServicos.labels, dadosServicos.values);
}

function prepararDadosPorPeriodo(consultas) {
    const tipoPeriodo = document.getElementById('tipoPeriodo').value;
    const consultasPorPeriodo = new Map();

    consultas.forEach(consulta => {
        const data = new Date(consulta.data);
        let periodo;

        switch (tipoPeriodo) {
            case 'diario':
                periodo = data.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                break;
            case 'semanal':
                const inicioSemana = new Date(data);
                inicioSemana.setDate(data.getDate() - data.getDay());
                const fimSemana = new Date(inicioSemana);
                fimSemana.setDate(inicioSemana.getDate() + 6);
                periodo = `${inicioSemana.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })} - ${fimSemana.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })}`;
                break;
            case 'mensal':
                periodo = data.toLocaleDateString('pt-BR', { month: 'long' });
                break;
            case 'anual':
                periodo = data.getFullYear().toString();
                break;
            default:
                periodo = data.toLocaleDateString('pt-BR');
        }

        consultasPorPeriodo.set(periodo, (consultasPorPeriodo.get(periodo) || 0) + 1);
    });

    return {
        labels: Array.from(consultasPorPeriodo.keys()),
        values: Array.from(consultasPorPeriodo.values())
    };
}

function prepararDadosComparecimento(consultas) {
    const total = consultas.length;
    const concluidas = consultas.filter(c => c.status === 'CONCLU√çDA').length;
    const canceladas = consultas.filter(c => c.status === 'CANCELADA').length;
    const agendadas = total - concluidas - canceladas;

    return {
        concluidas: (concluidas / total * 100).toFixed(1),
        canceladas: (canceladas / total * 100).toFixed(1),
        agendadas: (agendadas / total * 100).toFixed(1)
    };
}

function prepararDadosHorarios(consultas) {
    const horarios = {};
    consultas.forEach(consulta => {
        horarios[consulta.horario] = (horarios[consulta.horario] || 0) + 1;
    });

    const labels = Object.keys(horarios).sort();
    const values = labels.map(hora => horarios[hora]);

    return { labels, values };
}

function prepararDadosServicos(consultas) {
    const servicos = {};
    consultas.forEach(consulta => {
        if (consulta.servico) {
            servicos[consulta.servico] = (servicos[consulta.servico] || 0) + 1;
        }
    });

    const labels = Object.keys(servicos);
    const values = labels.map(servico => servicos[servico]);

    return { labels, values };
}

function criarGraficoConsultasPeriodo(labels, values) {
    const ctx = document.getElementById('graficoConsultasPeriodo').getContext('2d');
    
    if (window.graficoConsultasPeriodo instanceof Chart) {
        window.graficoConsultasPeriodo.destroy();
    }

    ctx.canvas.style.height = '250px';

    window.graficoConsultasPeriodo = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Consultas',
                data: values,
                backgroundColor: 'rgba(255, 255, 255, 0.8)',  // Branco com 80% de opacidade
                borderColor: 'rgba(255, 255, 255, 1)',       // Branco s√≥lido
                borderWidth: 1,
                borderRadius: 5,
                barThickness: 20
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 13
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,
                        font: {
                            size: 12
                        },
                        color: 'rgba(255, 255, 255, 0.8)'  // Texto dos eixos em branco
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'  // Grade em branco com baixa opacidade
                    }
                },
                x: {
                    ticks: {
                        font: {
                            size: 12
                        },
                        color: 'rgba(255, 255, 255, 0.8)'  // Texto dos eixos em branco
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'  // Grade em branco com baixa opacidade
                    }
                }
            }
        }
    });
}

function criarGraficoComparecimento(dados) {
    const ctx = document.getElementById('graficoComparecimento').getContext('2d');
    
    if (window.graficoComparecimento instanceof Chart) {
        window.graficoComparecimento.destroy();
    }

    ctx.canvas.style.height = '250px';

    window.graficoComparecimento = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Conclu√≠das', 'Canceladas', 'Agendadas'],
            datasets: [{
                data: [dados.concluidas, dados.canceladas, dados.agendadas],
                backgroundColor: [
                    'rgba(255, 255, 255, 0.9)',  // Branco mais claro
                    'rgba(255, 255, 255, 0.6)',  // Branco m√©dio
                    'rgba(255, 255, 255, 0.3)'   // Branco mais escuro
                ],
                borderColor: [
                    'rgba(255, 255, 255, 1)',
                    'rgba(255, 255, 255, 1)',
                    'rgba(255, 255, 255, 1)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            cutout: '60%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        font: {
                            size: 12
                        },
                        color: 'rgba(255, 255, 255, 0.9)'  // Texto da legenda em branco
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.raw}%`;
                        }
                    }
                }
            }
        }
    });
}

function criarGraficoHorarios(labels, values) {
    const ctx = document.getElementById('graficoHorarios').getContext('2d');
    
    if (window.graficoHorarios instanceof Chart) {
        window.graficoHorarios.destroy();
    }

    ctx.canvas.style.height = '250px';

    window.graficoHorarios = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Consultas',
                data: values,
                backgroundColor: 'rgba(255, 255, 255, 0.8)',  // Branco com 80% de opacidade
                borderColor: 'rgba(255, 255, 255, 1)',       // Branco s√≥lido
                borderWidth: 1,
                borderRadius: 5,
                barThickness: 20
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 13
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,
                        font: {
                            size: 12
                        },
                        color: 'rgba(255, 255, 255, 0.8)'  // Texto dos eixos em branco
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'  // Grade em branco com baixa opacidade
                    }
                },
                x: {
                    ticks: {
                        font: {
                            size: 12
                        },
                        color: 'rgba(255, 255, 255, 0.8)'  // Texto dos eixos em branco
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'  // Grade em branco com baixa opacidade
                    }
                }
            }
        }
    });
}

function criarGraficoServicos(labels, values) {
    const ctx = document.getElementById('graficoServicos').getContext('2d');
    
    if (window.graficoServicos instanceof Chart) {
        window.graficoServicos.destroy();
    }

    ctx.canvas.style.height = '250px';

    // Criar uma paleta de brancos com diferentes opacidades
    const cores = [
        'rgba(255, 255, 255, 0.9)',  // Branco mais claro
        'rgba(255, 255, 255, 0.8)',  // Branco claro
        'rgba(255, 255, 255, 0.7)',  // Branco m√©dio-claro
        'rgba(255, 255, 255, 0.6)',  // Branco m√©dio
        'rgba(255, 255, 255, 0.5)',  // Branco m√©dio-escuro
        'rgba(255, 255, 255, 0.4)'   // Branco mais escuro
    ];

    window.graficoServicos = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: cores,
                borderColor: cores.map(cor => 'rgba(255, 255, 255, 1)'),
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        font: {
                            size: 12
                        },
                        color: 'rgba(255, 255, 255, 0.9)'  // Texto da legenda em branco
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const porcentagem = ((context.raw / total) * 100).toFixed(1);
                            return `${context.label}: ${context.raw} (${porcentagem}%)`;
                        }
                    }
                }
            }
        }
    });
}

// ... existing code ...

function atualizarFiltrosPeriodo() {
    const tipoPeriodo = document.getElementById("tipoPeriodo");
    const dataInicial = document.getElementById("dataInicial");
    const dataFinal = document.getElementById("dataFinal");
    const hoje = new Date();

    // Definir a data de hoje como padr√£o para ambos os campos
    const hojeStr = hoje.toISOString().split("T")[0];
    dataInicial.value = hojeStr;
    dataFinal.value = hojeStr;

    // Adicionar evento de mudan√ßa na data inicial
    dataInicial.onchange = function() {
        if (dataFinal.value && dataInicial.value > dataFinal.value) {
            dataFinal.value = dataInicial.value;
        }
        dataFinal.min = dataInicial.value;
    };

    // Adicionar evento de mudan√ßa na data final
    dataFinal.onchange = function() {
        // Se a data final for diferente da inicial, mudar para personalizado
        if (dataInicial.value && dataFinal.value !== dataInicial.value) {
            tipoPeriodo.value = "personalizado";
        }
        
        if (dataInicial.value && dataFinal.value < dataInicial.value) {
            alert("A data final n√£o pode ser menor que a data inicial");
            dataFinal.value = dataInicial.value;
        }
    };

    switch (tipoPeriodo.value) {
        case "diario":
            dataInicial.value = hojeStr;
            dataFinal.value = hojeStr;
            break;
        case "semanal":
            const inicioSemana = new Date(hoje);
            inicioSemana.setDate(hoje.getDate() - hoje.getDay());
            const fimSemana = new Date(inicioSemana);
            fimSemana.setDate(inicioSemana.getDate() + 6);
            dataInicial.value = inicioSemana.toISOString().split("T")[0];
            dataFinal.value = fimSemana.toISOString().split("T")[0];
            break;
        case "mensal":
            const inicioMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            const fimMes = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
            dataInicial.value = inicioMes.toISOString().split("T")[0];
            dataFinal.value = fimMes.toISOString().split("T")[0];
            break;
        case "anual":
            const inicioAno = new Date(hoje.getFullYear(), 0, 1);
            const fimAno = new Date(hoje.getFullYear(), 11, 31);
            dataInicial.value = inicioAno.toISOString().split("T")[0];
            dataFinal.value = fimAno.toISOString().split("T")[0];
            break;
        case "personalizado":
            // Definir data m√≠nima como hoje para ambos os campos
            dataInicial.min = hojeStr;
            dataFinal.min = hojeStr;
            break;
    }

    // Atualizar o atributo min da data final baseado na data inicial
    if (dataInicial.value) {
        dataFinal.min = dataInicial.value;
    }
}

// ... existing code ...
</script>

<!-- Adicionar FullCalendar JS -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales-all.min.js'></script>

<!-- Adicionar Bootstrap JS antes do fechamento do body -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Adicionar Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>

